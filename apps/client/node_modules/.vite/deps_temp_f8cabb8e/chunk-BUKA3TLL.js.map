{
  "version": 3,
  "sources": ["../../../../../node_modules/rxdb/src/plugin.ts"],
  "sourcesContent": ["/**\n * this handles how plugins are added to rxdb\n * basically it changes the internal prototypes\n * by passing them to the plugins-functions\n */\nimport {\n    RxSchema\n} from './rx-schema.ts';\nimport {\n    basePrototype as RxDocumentPrototype\n} from './rx-document.ts';\nimport {\n    RxQueryBase\n} from './rx-query.ts';\nimport {\n    RxCollectionBase\n} from './rx-collection.ts';\nimport {\n    RxDatabaseBase\n} from './rx-database.ts';\nimport type {\n    RxPlugin\n} from './types/index.d.ts';\n\nimport { overwritable } from './overwritable.ts';\nimport {\n    HOOKS,\n    runPluginHooks\n} from './hooks.ts';\nimport { newRxError, newRxTypeError } from './rx-error.ts';\n\n/**\n * prototypes that can be manipulated with a plugin\n */\nconst PROTOTYPES: { [k: string]: any; } = {\n    RxSchema: RxSchema.prototype,\n    RxDocument: RxDocumentPrototype,\n    RxQuery: RxQueryBase.prototype,\n    RxCollection: RxCollectionBase.prototype,\n    RxDatabase: RxDatabaseBase.prototype\n};\n\nconst ADDED_PLUGINS: Set<RxPlugin | any> = new Set();\nconst ADDED_PLUGIN_NAMES: Set<string> = new Set();\n\n/**\n * Add a plugin to the RxDB library.\n * Plugins are added globally and cannot be removed.\n */\nexport function addRxPlugin(plugin: RxPlugin) {\n    runPluginHooks('preAddRxPlugin', { plugin, plugins: ADDED_PLUGINS });\n\n    // do nothing if added before\n    if (ADDED_PLUGINS.has(plugin)) {\n        return;\n    } else {\n\n        // ensure no other plugin with the same name was already added\n        if (ADDED_PLUGIN_NAMES.has(plugin.name)) {\n            throw newRxError('PL3', {\n                name: plugin.name,\n                plugin,\n            });\n        }\n\n        ADDED_PLUGINS.add(plugin);\n        ADDED_PLUGIN_NAMES.add(plugin.name);\n    }\n\n    /**\n     * To identify broken configurations,\n     * we only allow RxDB plugins to be passed into addRxPlugin().\n     */\n    if (!plugin.rxdb) {\n        throw newRxTypeError('PL1', {\n            plugin\n        });\n    }\n\n    if (plugin.init) {\n        plugin.init();\n    }\n\n    // prototype-overwrites\n    if (plugin.prototypes) {\n        Object\n            .entries(plugin.prototypes)\n            .forEach(([name, fun]) => {\n                return (fun as any)(PROTOTYPES[name]);\n            });\n    }\n    // overwritable-overwrites\n    if (plugin.overwritable) {\n        Object.assign(\n            overwritable,\n            plugin.overwritable\n        );\n    }\n    // extend-hooks\n    if (plugin.hooks) {\n        Object\n            .entries(plugin.hooks)\n            .forEach(([name, hooksObj]) => {\n                if (hooksObj.after) {\n                    HOOKS[name].push(hooksObj.after);\n                }\n                if (hooksObj.before) {\n                    HOOKS[name].unshift(hooksObj.before);\n                }\n            });\n    }\n}\n\n"],
  "mappings": ";;;;;;;;;;;;;;;;AAkCA,IAAMA,aAAoC;EACtCC,UAAUA,SAASC;EACnBC,YAAYC;EACZC,SAASC,YAAYJ;EACrBK,cAAcC,iBAAiBN;EAC/BO,YAAYC,eAAeR;AAC/B;AAEA,IAAMS,gBAAqC,oBAAIC,IAAI;AACnD,IAAMC,qBAAkC,oBAAID,IAAI;AAMzC,SAASE,YAAYC,QAAkB;AAC1CC,iBAAe,kBAAkB;IAAED;IAAQE,SAASN;EAAc,CAAC;AAGnE,MAAIA,cAAcO,IAAIH,MAAM,GAAG;AAC3B;EACJ,OAAO;AAGH,QAAIF,mBAAmBK,IAAIH,OAAOI,IAAI,GAAG;AACrC,YAAMC,WAAW,OAAO;QACpBD,MAAMJ,OAAOI;QACbJ;MACJ,CAAC;IACL;AAEAJ,kBAAcU,IAAIN,MAAM;AACxBF,uBAAmBQ,IAAIN,OAAOI,IAAI;EACtC;AAMA,MAAI,CAACJ,OAAOO,MAAM;AACd,UAAMC,eAAe,OAAO;MACxBR;IACJ,CAAC;EACL;AAEA,MAAIA,OAAOS,MAAM;AACbT,WAAOS,KAAK;EAChB;AAGA,MAAIT,OAAOU,YAAY;AACnBC,WACKC,QAAQZ,OAAOU,UAAU,EACzBG,QAAQ,CAAC,CAACT,MAAMU,GAAG,MAAM;AACtB,aAAQA,IAAY7B,WAAWmB,IAAI,CAAC;IACxC,CAAC;EACT;AAEA,MAAIJ,OAAOe,cAAc;AACrBJ,WAAOK,OACHD,cACAf,OAAOe,YACX;EACJ;AAEA,MAAIf,OAAOiB,OAAO;AACdN,WACKC,QAAQZ,OAAOiB,KAAK,EACpBJ,QAAQ,CAAC,CAACT,MAAMc,QAAQ,MAAM;AAC3B,UAAIA,SAASC,OAAO;AAChBC,cAAMhB,IAAI,EAAEiB,KAAKH,SAASC,KAAK;MACnC;AACA,UAAID,SAASI,QAAQ;AACjBF,cAAMhB,IAAI,EAAEmB,QAAQL,SAASI,MAAM;MACvC;IACJ,CAAC;EACT;AACJ;",
  "names": ["PROTOTYPES", "RxSchema", "prototype", "RxDocument", "RxDocumentPrototype", "RxQuery", "RxQueryBase", "RxCollection", "RxCollectionBase", "RxDatabase", "RxDatabaseBase", "ADDED_PLUGINS", "Set", "ADDED_PLUGIN_NAMES", "addRxPlugin", "plugin", "runPluginHooks", "plugins", "has", "name", "newRxError", "add", "rxdb", "newRxTypeError", "init", "prototypes", "Object", "entries", "forEach", "fun", "overwritable", "assign", "hooks", "hooksObj", "after", "HOOKS", "push", "before", "unshift"]
}
